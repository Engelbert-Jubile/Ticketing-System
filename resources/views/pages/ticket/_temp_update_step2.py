from pathlib import Path
path = Path(r"resources/views/pages/ticket/create.blade.php")
text = path.read_text(encoding='utf-8')
old_start = '      <div data-step="2" class="step-section hidden space-y-6">'
start = text.find(old_start)
if start == -1:
    raise SystemExit('start marker not found')
next_marker = '        <div data-step="3"'
end = text.find(next_marker, start)
if end == -1:
    raise SystemExit('end marker not found')
new_block = """      <div data-step=\"2\" class=\"step-section hidden space-y-8\">\n        <div class=\"mx-auto flex w-full max-w-5xl flex-col gap-6\">\n          <div class=\"grid gap-6 lg:grid-cols-[minmax(0,1.35fr)_minmax(0,1fr)]\">\n            <div class=\"space-y-6\">\n              {{-- Data & Details --}}\n              <div class=\"rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-gray-700 dark:bg-gray-800\">\n                <div class=\"flex flex-col gap-2 md:flex-row md:items-start md:justify-between\">\n                  <div>\n                    <h3 class=\"text-sm font-semibold text-gray-700 dark:text-gray-200\">Data &amp; Details</h3>\n                    <p class=\"text-xs text-gray-500 dark:text-gray-400\">Tentukan isi data pada ticket.</p>\n                  </div>\n                  <div class=\"text-right text-xs text-gray-500 dark:text-gray-400\">\n                    <span class=\"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-[11px] font-semibold text-blue-700 dark:bg-blue-900 dark:text-blue-100\">Status: New</span>\n                  </div>\n                </div>\n                <input type=\"hidden\" name=\"status\" value=\"new\">\n                <div class=\"mt-4 grid gap-4 md:grid-cols-2\">\n                  <div>\n                    <label class=\"mb-1 block text-sm font-medium\">Prioritas</label>\n                    <select name=\"priority\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\" required>\n                      @foreach (['high','medium','low'] as $p)\n                      <option value=\"{{ $p }}\" @selected(old('priority','medium')===$p)>{{ ucfirst($p) }}</option>\n                      @endforeach\n                    </select>\n                  </div>\n                  <div>\n                    <label class=\"mb-1 block text-sm font-medium\">Tipe</label>\n                    <select name=\"type\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\" required>\n                      @foreach (['task','project'] as $t)\n                      <option value=\"{{ $t }}\" @selected(old('type','task')===$t)>{{ ucfirst($t) }}</option>\n                      @endforeach\n                    </select>\n                  </div>\n                  <div>\n                    <label class=\"mb-1 block text-sm font-medium\">SLA</label>\n                    <select name=\"sla\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                      <option value=\"\">-- Pilih --</option>\n                      @foreach (['ontime','late'] as $s)\n                      <option value=\"{{ $s }}\" @selected(old('sla')===$s)>{{ strtoupper($s) }}</option>\n                      @endforeach\n                    </select>\n                  </div>\n                  @if ($canPickRequester)\n                  <div>\n                    <label class=\"mb-1 block text-sm font-medium\">Requester</label>\n                    <select name=\"requester_id\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                      <option value=\"\">-- Pilih --</option>\n                      @foreach ($users as $u)\n                      @php $label = $u->label ?? ($u->name ?? ($u->email ?? 'User #'.$u->id)); @endphp\n                      <option value=\"{{ $u->id }}\" @selected(old('requester_id')==$u->id)>{{ $label }}</option>\n                      @endforeach\n                    </select>\n                    @error('requester_id') <p class=\"mt-1 text-xs text-red-600\">{{ $message }}</p> @enderror\n                  </div>\n                  @else\n                  @php\n                  $authUser = auth()->user();\n                  $defaultRequester = old('requester_id', $authUser?->id);\n                  $requesterLabel = $authUser?->display_name ?? $authUser?->name ?? $authUser?->email ?? 'User';\n                  @endphp\n                  <input type=\"hidden\" name=\"requester_id\" value=\"{{ $defaultRequester }}\">\n                  <div class=\"md:col-span-2\">\n                    <label class=\"mb-1 block text-sm font-medium\">Requester</label>\n                    <div class=\"rounded-lg border border-dashed border-gray-300 bg-gray-50 px-3 py-2 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-200\">\n                      {{ $requesterLabel }}\n                      <span class=\"block text-[11px] text-gray-500 dark:text-gray-400\">Requester otomatis mengikuti akun yang sedang login.</span>\n                    </div>\n                  </div>\n                  @endif\n                  <div>\n                    <label class=\"mb-1 block text-sm font-medium\">Agent (opsional)</label>\n                    <select name=\"agent_id\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                      <option value=\"\">-- Pilih --</option>\n                      @foreach ($users as $u)\n                      @php $label = $u->label ?? ($u->name ?? ($u->email ?? 'User #'.$u->id)); @endphp\n                      <option value=\"{{ $u->id }}\" @selected(old('agent_id')==$u->id)>{{ $label }}</option>\n                      @endforeach\n                    </select>\n                  </div>\n                  <div class=\"md:col-span-2\">\n                    <div class=\"mb-1 flex items-center justify-between\">\n                      <label class=\"block text-sm font-medium\">Assigned Users</label>\n                      <span class=\"text-xs text-gray-500 dark:text-gray-400\">Opsional</span>\n                    </div>\n                    <div class=\"space-y-2\">\n                      <div class=\"relative\">\n                        <select id=\"assignee_picker\" class=\"assignee-picker\" data-placeholder=\"Pilih pengguna\">\n                          <option value=\"\">-- Pilih pengguna --</option>\n                          @foreach ($users as $u)\n                          @php $label = $u->label ?? ($u->name ?? ($u->email ?? 'User #' . $u->id)); @endphp\n                          <option value=\"{{ $u->id }}\">{{ $label }}</option>\n                          @endforeach\n                        </select>\n                      </div>\n                      <p class=\"text-xs text-gray-500 dark:text-gray-400\">Pilih pengguna untuk langsung menambahkannya ke daftar di bawah.</p>\n                      <div id=\"assignee_list\" class=\"assignee-list\">\n                        @foreach ($assignedSelected as $assignedId)\n                        @php $user = $assignedPrefill[$assignedId] ?? $users->firstWhere('id', $assignedId); @endphp\n                        @if ($user)\n                        @php $label = $user->label ?? ($user->name ?? ($user->email ?? 'User #' . $user->id)); @endphp\n                        <span class=\"assignee-chip\" data-user-id=\"{{ $user->id }}\">\n                          <span class=\"assignee-chip-label\">{{ $label }}</span>\n                          <button type=\"button\" class=\"remove-assignee\" aria-label=\"Hapus {{ $label }}\">&times;</button>\n                          <input type=\"hidden\" name=\"assigned_user_ids[]\" value=\"{{ $user->id }}\">\n                        </span>\n                        @endif\n                        @endforeach\n                      </div>\n                      <p class=\"text-xs text-gray-500 dark:text-gray-400\">Tambahkan lebih dari satu pengguna sebagai kolaborator atau pihak yang perlu memantau tiket ini.</p>\n                    </div>\n                  </div>\n                  <div class=\"md:col-span-2\">\n                    <label class=\"mb-1 block text-sm font-medium\">Reason (opsional)</label>\n                    <input type=\"text\" name=\"reason\" value=\"{{ old('reason') }}\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                  </div>\n                  <div class=\"md:col-span-2\">\n                    <label class=\"mb-1 block text-sm font-medium\">No. Surat (opsional)</label>\n                    <input type=\"text\" name=\"letter_no\" value=\"{{ old('letter_no') }}\" class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"space-y-6\">\n              {{-- Timeline --}}\n              <div class=\"rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-gray-700 dark:bg-gray-800\">\n                <div class=\"flex flex-col gap-2\">\n                  <h3 class=\"text-sm font-semibold text-gray-700 dark:text-gray-200\">Timeline</h3>\n                  <p class=\"text-xs text-gray-500 dark:text-gray-400\">Atur target due dan jadwal selesai tiket.</p>\n                </div>\n                <div class=\"mt-4 grid gap-6 md:grid-cols-2\">\n                  <div class=\"space-y-2\">\n                    <label for=\"due_date\" class=\"mb-1 block text-sm font-medium\">Due Date</label>\n                    <input id=\"due_date\" name=\"due_date\" type=\"text\" placeholder=\"dd/mm/yyyy\" autocomplete=\"off\"\n                      value=\"{{ old('due_date') }}\"\n                      class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                    <label class=\"block text-xs text-gray-500 dark:text-gray-400\">Due Time</label>\n                    <div class=\"tf-group\">\n                      <button type=\"button\" class=\"tf-btn\" data-target=\"#due_time\" title=\"Pilih jam\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16Zm.75-12a.75.75 0 00-1.5 0v4c0 .199.079.39.22.53l2.5 2.5a.75.75 0 101.06-1.06l-2.28-2.28V6z\" clip-rule=\"evenodd\" />\n                        </svg>\n                      </button>\n                      <input id=\"due_time\" name=\"due_time\" type=\"text\" inputmode=\"numeric\" autocomplete=\"off\" data-time-picker=\"1\" placeholder=\"hh:mm\"\n                        value=\"{{ old('due_time') }}\" class=\"tf-input\">\n                    </div>\n                    <div class=\"time-chip-row\">\n                      <span class=\"time-chip-label\">Jam cepat:</span>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#due_time\" data-time=\"08:00\">08:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#due_time\" data-time=\"12:00\">12:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#due_time\" data-time=\"15:00\">15:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#due_time\" data-time=\"17:00\">17:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#due_time\" data-time=\"now\">Sekarang</button>\n                    </div>\n                    <div id=\"due_hint\" class=\"text-xs text-gray-500 dark:text-gray-400\"></div>\n                  </div>\n                  <div class=\"space-y-2\">\n                    <label for=\"finish_date\" class=\"mb-1 block text-sm font-medium\">Finish Date (opsional)</label>\n                    <input id=\"finish_date\" name=\"finish_date\" type=\"text\" placeholder=\"dd/mm/yyyy\" autocomplete=\"off\"\n                      value=\"{{ old('finish_date') }}\"\n                      class=\"w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100\">\n                    <label class=\"block text-xs text-gray-500 dark:text-gray-400\">Finish Time</label>\n                    <div class=\"tf-group\">\n                      <button type=\"button\" class=\"tf-btn\" data-target=\"#finish_time\" title=\"Pilih jam\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                          <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16Zm.75-12a.75.75 0 00-1.5 0v4c0 .199.079.39.22.53l2.5 2.5a.75.75 0 101.06-1.06l-2.28-2.28V6z\" clip-rule=\"evenodd\" />\n                        </svg>\n                      </button>\n                      <input id=\"finish_time\" name=\"finish_time\" type=\"text\" inputmode=\"numeric\" autocomplete=\"off\" data-time-picker=\"1\" placeholder=\"hh:mm\"\n                        value=\"{{ old('finish_time') }}\" class=\"tf-input\">\n                    </div>\n                    <div class=\"time-chip-row\">\n                      <span class=\"time-chip-label\">Jam cepat:</span>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#finish_time\" data-time=\"10:00\">10:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#finish_time\" data-time=\"13:00\">13:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#finish_time\" data-time=\"18:00\">18:00</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#finish_time\" data-time=\"23:59\">23:59</button>\n                      <button type=\"button\" class=\"time-chip\" data-target=\"#finish_time\" data-time=\"copy-due\">Sama dengan due</button>\n                    </div>\n                  </div>\n                </div>\n                <label class=\"mt-3 inline-flex select-none items-center gap-2 text-xs\">\n                  <input id=\"copy_finish_from_due\" type=\"checkbox\" class=\"rounded border-gray-300 text-blue-600\">\n                  Samakan finish dengan due (auto-sync)\n                </label>\n              </div>\n            </div>\n          </div>\n          <div class=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n            <button type=\"button\" data-prev-step=\"1\"\n              class=\"w-full rounded-lg border border-gray-300 px-4 py-2 text-sm hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800 sm:w-auto\">Kembali</button>\n            <button type=\"button\" data-next-step=\"3\"\n              class=\"w-full rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 sm:w-auto sm:ml-auto\">Lanjut</button>\n          </div>\n        </div>\n      </div>\n"""
text = text[:start] + new_block + text[end:]
path.write_text(text, encoding='utf-8')
